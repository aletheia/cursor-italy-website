---
import clsx from 'clsx';
import {
  Calendar,
  Clock,
  MapPin,
  Users,
  ArrowRight,
  ExternalLink,
} from 'lucide-react';
import type { CollectionEntry } from 'astro:content';

interface Props {
  event: CollectionEntry<'events'>;
  variant?: 'default' | 'featured' | 'compact';
  showContent?: boolean;
}

const { event, variant = 'default', showContent = false } = Astro.props;

const { data, slug, body } = event;
const eventDate = new Date(data.date);
// Compare dates only (not time) for determining if event is upcoming
const today = new Date();
today.setHours(0, 0, 0, 0);
const eventDateOnly = new Date(data.date);
eventDateOnly.setHours(0, 0, 0, 0);
const isUpcoming = eventDateOnly >= today;

const formattedDate = eventDate.toLocaleDateString('en-US', {
  weekday: 'short',
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});

const formatTime = (time: string, timezone?: string) => {
  const [hours, minutes] = time.split(':');
  const date = new Date();
  date.setHours(parseInt(hours), parseInt(minutes));
  return (
    date.toLocaleTimeString('en-US', {
      hour: 'numeric',
      minute: '2-digit',
      hour12: true,
    }) + (timezone ? ` ${timezone}` : '')
  );
};
---

{variant === 'compact' ? (
  <div class='bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200'>
    <div class='flex items-start justify-between'>
      <div class='flex-1 min-w-0'>
        <h3 class='font-semibold text-gray-900 truncate mb-1'>
          {data.title}
        </h3>
        <div class='flex items-center text-sm text-gray-600 mb-2'>
          <Calendar className='w-4 h-4 mr-1' />
          <span>{formattedDate}</span>
          <span class='mx-2'>•</span>
          <Clock className='w-4 h-4 mr-1' />
          <span>{formatTime(data.startTime, data.timezone)}</span>
        </div>
        <div class='flex items-center text-sm text-gray-600'>
          <MapPin className='w-4 h-4 mr-1 flex-shrink-0' />
          <span class='truncate'>{data.location}</span>
        </div>
      </div>

      <div class='ml-4 flex items-center space-x-2'>
        {data.attendees && (
          <div class='flex items-center text-sm text-gray-600'>
            <Users className='w-4 h-4 mr-1' />
            <span>{data.attendees}</span>
          </div>
        )}
        {isUpcoming && data.registrationUrl && (
          <a
            href={data.registrationUrl}
            target='_blank'
            rel='noopener noreferrer'
            class='btn btn-primary btn-sm text-xs px-2 py-1'
          >
            Register
          </a>
        )}
        <a
          href={`/events/${slug}`}
          class='text-cursor-blue hover:text-blue-700 transition-colors duration-200'
        >
          <ArrowRight className='w-4 h-4' />
        </a>
      </div>
    </div>
  </div>
) : (
  <div
    class={clsx(
      'bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all duration-200',
      variant === 'featured' ? 'lg:col-span-2 card-hover' : 'card-hover',
      isUpcoming ? 'ring-2 ring-cursor-blue/20' : ''
    )}
  >
    <!-- Event Image -->
    {data.image && (
      <div
        class={clsx(
          'relative overflow-hidden',
          variant === 'featured' ? 'h-64' : 'h-48'
        )}
      >
        <img
          src={data.image}
          alt={data.title}
          class='object-cover w-full h-full transition-transform duration-200 hover:scale-105'
        />

        <!-- Status Badge -->
        <div class='absolute top-4 left-4'>
          <span
            class={clsx(
              'inline-flex items-center px-3 py-1 rounded-full text-xs font-medium',
              isUpcoming
                ? 'bg-green-100 text-green-800'
                : 'bg-gray-100 text-gray-800'
            )}
          >
            {isUpcoming ? 'Upcoming' : 'Past Event'}
          </span>
        </div>

        <!-- Date Badge -->
        <div class='absolute top-4 right-4 bg-white/90 backdrop-blur-sm rounded-lg p-3 text-center'>
          <div class='text-sm font-semibold text-gray-900'>
            {eventDate.getDate()}
          </div>
          <div class='text-xs text-gray-600 uppercase'>
            {eventDate.toLocaleDateString('en-US', { month: 'short' })}
          </div>
        </div>
      </div>
    )}

    <!-- Event Content -->
    <div class='p-6'>
      <div class='space-y-4'>
        <!-- Event Title -->
        <div>
          <h3
            class={clsx(
              'font-semibold text-gray-900 leading-tight',
              variant === 'featured' ? 'text-xl lg:text-2xl' : 'text-lg'
            )}
          >
            {data.title}
          </h3>
          {data.description && (
            <p class='text-gray-600 mt-2 line-clamp-2'>
              {data.description}
            </p>
          )}
        </div>

        <!-- Event Details -->
        <div class='space-y-2'>
          <div class='flex items-center text-sm text-gray-600'>
            <Calendar className='w-4 h-4 mr-2 flex-shrink-0' />
            <span>{formattedDate}</span>
            <span class='mx-2'>•</span>
            <Clock className='w-4 h-4 mr-1' />
            <span>{formatTime(data.startTime, data.timezone)}</span>
            {data.endTime && (
              <>
                <span class='mx-1'>-</span>
                <span>{formatTime(data.endTime, data.timezone)}</span>
              </>
            )}
          </div>

          <div class='flex items-center text-sm text-gray-600'>
            <MapPin className='w-4 h-4 mr-2 flex-shrink-0' />
            <span class='flex-1'>{data.location}</span>
            {data.locationUrl && (
              <a
                href={data.locationUrl}
                target='_blank'
                rel='noopener noreferrer'
                class='text-cursor-blue hover:text-blue-700 transition-colors duration-200'
              >
                <ExternalLink className='w-4 h-4' />
              </a>
            )}
          </div>
        </div>

        <!-- Tags -->
        {data.tags && data.tags.length > 0 && (
          <div class='flex flex-wrap gap-2'>
            {data.tags.map(tag => (
              <span
                class='inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800'
              >
                {tag}
              </span>
            ))}
          </div>
        )}

        <!-- Speakers -->
        {data.speakers && data.speakers.length > 0 && (
          <div class='space-y-2'>
            <h4 class='font-medium text-gray-900'>Speakers:</h4>
            <div class='space-y-1'>
              {data.speakers.map((speaker) => (
                <div class='text-sm'>
                  <span class='font-medium text-gray-900'>
                    {speaker.name}
                  </span>
                  {speaker.topic && (
                    <span class='text-gray-600'> - {speaker.topic}</span>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}

        <!-- Actions -->
        <div class='flex flex-wrap gap-3 pt-4'>
          <a
            href={`/events/${slug}`}
            class='btn btn-primary btn-sm flex-1 sm:flex-none'
          >
            View Details
            <ArrowRight className='w-4 h-4 ml-2' />
          </a>

          {isUpcoming && data.registrationUrl && (
            <a
              href={data.registrationUrl}
              target='_blank'
              rel='noopener noreferrer'
              class='btn btn-secondary btn-sm flex-1 sm:flex-none'
            >
              Register
              <ExternalLink className='w-4 h-4 ml-2' />
            </a>
          )}
        </div>
      </div>
    </div>
  </div>
)}
